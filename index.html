```html
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>–û—Ç–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞ ‚Äî –ö–∏–µ–≤</title>
  <style>
    :root {
      /* Dark mobile-native theme (default) */
      --bg: #000000;
      --card: #1c1c1e;
      --primary: #0a84ff;
      --ok: #30d158;
      --warn: #ff453a;
      --muted: #8e8e93;
      --border: #2c2c2e;
    }

    .light {
      /* Light mobile-native theme (iOS / Android) */
      --bg: #f2f2f7;            /* iOS system background */
      --card: #ffffff;         /* cards */
      --primary: #0a84ff;      /* iOS blue */
      --ok: #34c759;           /* iOS green */
      --warn: #ff3b30;         /* iOS red */
      --muted: #6c6c70;        /* secondary label */
      --border: #d1d1d6;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', system-ui, Roboto, sans-serif;
      background: var(--bg);
      color: #f2f2f7; /* dark theme text */
      padding: 16px;
      max-width: 720px;
      margin: 0 auto;
      -webkit-font-smoothing: antialiased;
      font-size: 17px; /* –±–∞–∑–æ–≤—ã–π –º–æ–±–∏–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
    }

    body.light {
      color: #1c1c1e; /* light theme text */
    }
    

    h1 {
      margin: 4px 0 14px 0;
      font-size: 1.5rem; /* –∫—Ä—É–ø–Ω–µ–µ –Ω–∞ –º–æ–±–∏–ª–µ */
      font-weight: 600;
    }

    .controls {
      margin-bottom: 14px;
    }

    select {
      padding: 12px 16px;
      border-radius: 12px;
      border: 1px solid var(--border);
      background: var(--card);
      color: inherit;
      font-size: 1.05rem;
      appearance: none;
    }
    

    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 14px 16px;
      margin-bottom: 12px;
    }

    .status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 600;
      font-size: 1.15rem; /* —Å—Ç–∞—Ç—É—Å –∫—Ä—É–ø–Ω–µ–µ */
    }

    .status.on { color: var(--ok); }
    .status.off { color: var(--warn); }

    .sub {
      color: var(--muted);
      font-size: 1.05rem; /* —Ç–µ–∫—Å—Ç —Ç–∞–π–º–µ—Ä–∞ –∫—Ä—É–ø–Ω–µ–µ */
      margin-top: 6px;
    }

    .sub.warn {
      color: var(--warn);
      font-weight: 600;
    }

    .day-title {
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.95rem;
      color: inherit;
    }

    .slots {
      display: grid;
      gap: 6px;
    }

    .slot {
      padding: 12px 14px;
      border-radius: 12px;
      background: var(--card);
      border: 1px solid var(--border);
      font-size: 1.05rem; /* —Å–ª–æ—Ç—ã —á–∏—Ç–∞–µ–º—ã–µ */
    }

    .slot.next {
      background: rgba(10,132,255,0.15);
      border-left: 4px solid var(--primary);
    }

    .slot.current {
      background: rgba(255,69,58,0.18);
      border-left: 4px solid var(--warn);
      font-weight: 600;
    }

    .week .slot {
      font-size: 0.85rem;
      background: var(--card);
    }

    .error {
      color: var(--warn);
      font-weight: 600;
    }
  </style>
</head>
<body>
  <h1 id="title">–ö–∏–µ–≤ ‚Äî –≥—Ä—É–ø–ø–∞ 2.2</h1>

  <div class="controls">
    –ì–æ—Ä–æ–¥:
    <select id="citySelect"></select>
    
    –ì—Ä—É–ø–ø–∞:
    <select id="groupSelect"></select>
    
    <button id="themeToggle" style="margin-left:12px;padding:10px 14px;border-radius:12px;border:none;background:var(--card);color:inherit;">üåô</button>
  </div>

  <div id="output">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>

  <script>
    const URL = 'https://corsproxy.io/?https://api.yasno.com.ua/api/v1/pages/home/schedule-turn-off-electricity';
    const DEFAULT_CITY = 'kiev';
    const DEFAULT_GROUP = 'group_2.2';

    // ===== helpers for dailySchedule =====
    function toTimeFromString(str) {
      return str;
    }

    function parseTime(str, baseDate) {
      const [h, m] = str.split(':').map(Number);
      const d = new Date(baseDate);
      d.setHours(h, m, 0, 0);
      return d;
    }

    function formatHM(date) {
      return `${String(date.getHours()).padStart(2,'0')}:${String(date.getMinutes()).padStart(2,'0')}`;
    }`;
    }:${m}`;
    }

    function kyivNow() {
      return new Date(new Date().toLocaleString('en-US', { timeZone: 'Europe/Kyiv' }));
    }

    // === helpers for fail-safe & storage ===
    const STORAGE_KEYS = {
      city: 'yasno_city',
      group: 'yasno_group',
      theme: 'yasno_theme'
    };

    function safeGet(id) {
      return document.getElementById(id) || null;
    }

    function save(key, value) {
      try { localStorage.setItem(key, value); } catch {}
    }

    function load(key) {
      try { return localStorage.getItem(key); } catch { return null; }
    }

    async function loadSchedule() {
      const output = safeGet('output');
      const groupSelect = safeGet('groupSelect');
      const citySelect = safeGet('citySelect');

      if (!output || !groupSelect || !citySelect) {
        console.warn('UI elements missing, abort render');
        return;
      }

      try {
        const res = await fetch(URL);
        const json = await res.json();

        const component = json.components.find(c => c.template_name === 'electricity-outages-daily-schedule');
        const schedule = component?.schedule;
        const dailySchedule = component?.dailySchedule;

        // üîπ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (storage ‚Üí default)
        let cityKey = load(STORAGE_KEYS.city) || DEFAULT_CITY;

        // üîπ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (storage ‚Üí default)
        // üîπ —Å–ø–∏—Å–æ–∫ –≥–æ—Ä–æ–¥–æ–≤
        citySelect.innerHTML = '';
        Object.keys(schedule || {}).forEach(city => {
          const opt = document.createElement('option');
          opt.value = city;
          opt.textContent = city.charAt(0).toUpperCase() + city.slice(1);
          if (city === cityKey) opt.selected = true;
          citySelect.appendChild(opt);
        });

        // –¥–∞–Ω–Ω—ã–µ –ø–æ –≥–æ—Ä–æ–¥—É: —Å–Ω–∞—á–∞–ª–∞ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ (dailySchedule), –∑–∞—Ç–µ–º fallback –Ω–∞ –ø–ª–∞–Ω
        let cityDaily = dailySchedule?.[cityKey];
        let cityData = cityDaily?.groups || schedule?.[cityKey] || schedule?.[Object.keys(schedule || {})[0]];

        if (!cityData) {
          output.innerHTML = '<div class="error">–ì–æ—Ä–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω</div>';
          return;
        }

        groupSelect.innerHTML = '';
        Object.keys(cityData).forEach(g => {
          const opt = document.createElement('option');
          opt.value = g;
          opt.textContent = g.replace('group_', '');
          if (g === (load(STORAGE_KEYS.group) || DEFAULT_GROUP)) opt.selected = true;
          groupSelect.appendChild(opt);
        });

        function render(groupKey) {
          const now = kyivNow();

          // ===== DAILY SCHEDULE (REAL DATA) =====
          const groupDaily = cityDaily?.groups?.[groupKey];
          const groupPlan = cityData[groupKey];

          document.getElementById('title').textContent = `${cityKey.charAt(0).toUpperCase() + cityKey.slice(1)} ‚Äî –≥—Ä—É–ø–ø–∞ ${groupKey.replace('group_', '')}`;

          function getDailyIntervals(dateObj) {
            if (!groupDaily?.days) return [];
            const dateStr = dateObj.toISOString().slice(0,10);
            const day = groupDaily.days.find(d => d.date === dateStr);
            return day?.intervals || [];
          }

          const todayRaw = getDailyIntervals(now);
          const tomorrow = new Date(now.getTime() + 86400000);
          const tomorrowRaw = getDailyIntervals(tomorrow);

          const todayOutages = todayRaw.filter(s => s.type === 'DEFINITE_OUTAGE');

          let isNowOff = false;
          let nextSlot = null;
          let currentSlot = null;

          todayOutages.forEach(s => {
            const from = parseTime(s.start, now);
            const to = parseTime(s.end, now);

            if (now >= from && now <= to) {
              isNowOff = true;
              currentSlot = s;
            }
            if (from > now && !nextSlot) nextSlot = s;
          });

          output.innerHTML = '';

          // ===== STATUS CARD =====
          const cardStatus = document.createElement('div');
          cardStatus.className = 'card';

          const status = document.createElement('div');
          status.className = 'status ' + (isNowOff ? 'off' : 'on');
          status.textContent = isNowOff ? '‚ö° –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–π—á–∞—Å' : 'üí° –°–≤–µ—Ç –µ—Å—Ç—å';

          const sub = document.createElement('div');
          sub.className = 'sub';

          if (isNowOff && currentSlot) {
            const to = parseTime(currentSlot.end, now);
            const diffMin = Math.max(0, Math.floor((to - now) / 60000));
            const h = Math.floor(diffMin / 60);
            const m = diffMin % 60;
            sub.textContent = `–î–æ –≤–∫–ª—é—á–µ–Ω–∏—è: ${h > 0 ? h + ' —á ' : ''}${m} –º–∏–Ω`;
          } else if (nextSlot) {
            const from = parseTime(nextSlot.start, now);
            const diffMin = Math.max(0, Math.floor((from - now) / 60000));
            const h = Math.floor(diffMin / 60);
            const m = diffMin % 60;
            sub.classList.add('warn');
            sub.textContent = `–î–æ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è: ${h > 0 ? h + ' —á ' : ''}${m} –º–∏–Ω (${nextSlot.start} ‚Äî ${nextSlot.end})`;
          } else {
            sub.textContent = '–û—Ç–∫–ª—é—á–µ–Ω–∏–π –±–æ–ª—å—à–µ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è';
          }

          cardStatus.appendChild(status);
          cardStatus.appendChild(sub);
          output.appendChild(cardStatus);

          // ===== DAYS RENDER =====
          function renderDay(title, slots, highlightToday, baseDate) {
            const card = document.createElement('div');
            card.className = 'card day';

            const t = document.createElement('div');
            t.className = 'day-title';
            t.textContent = title;
            card.appendChild(t);

            const list = document.createElement('div');
            list.className = 'slots';

            if (!slots.length) {
              const empty = document.createElement('div');
              empty.className = 'slot';
              empty.textContent = '–ù–µ—Ç –æ—Ç–∫–ª—é—á–µ–Ω–∏–π';
              list.appendChild(empty);
            }

            slots.forEach(s => {
              const div = document.createElement('div');
              div.className = 'slot';
              div.textContent = `${s.start} ‚Äî ${s.end}`;

              if (highlightToday && s.type === 'DEFINITE_OUTAGE') {
                const from = parseTime(s.start, baseDate);
                const to = parseTime(s.end, baseDate);
                if (now >= from && now <= to) div.classList.add('current');
                else if (nextSlot === s) div.classList.add('next');
              }

              list.appendChild(div);
            });

            card.appendChild(list);
            output.appendChild(card);
          }

          renderDay('–°–µ–≥–æ–¥–Ω—è', todayRaw, true, now);
          renderDay('–ó–∞–≤—Ç—Ä–∞', tomorrowRaw, false, tomorrow);
        }

        const initialGroup = load(STORAGE_KEYS.group) || DEFAULT_GROUP;
        render(initialGroup);

        citySelect.onchange = () => {
          save(STORAGE_KEYS.city, citySelect.value);
          cityKey = citySelect.value;
          cityDaily = dailySchedule?.[cityKey];
          cityData = cityDaily?.groups || schedule?.[cityKey];
          if (!cityData) return;

          groupSelect.innerHTML = '';
          Object.keys(cityData).forEach(g => {
            const opt = document.createElement('option');
            opt.value = g;
            opt.textContent = g.replace('group_', '');
            groupSelect.appendChild(opt);
          });

          render(groupSelect.value);
        };

        groupSelect.onchange = () => {
          save(STORAGE_KEYS.group, groupSelect.value);
          render(groupSelect.value);
        };

        setInterval(() => render(groupSelect.value), 5 * 60 * 1000);
        }

        const initialGroup = load(STORAGE_KEYS.group) || DEFAULT_GROUP;
        render(initialGroup);

        citySelect.onchange = () => {
          save(STORAGE_KEYS.city, citySelect.value);
          cityKey = citySelect.value;
          cityData = schedule?.[cityKey];
          if (!cityData) return;

          groupSelect.innerHTML = '';
          Object.keys(cityData).forEach(g => {
            const opt = document.createElement('option');
            opt.value = g;
            opt.textContent = g.replace('group_', '');
            if (g === DEFAULT_GROUP) opt.selected = true;
            groupSelect.appendChild(opt);
          });

          render(groupSelect.value);
        };
        groupSelect.onchange = () => {
          save(STORAGE_KEYS.group, groupSelect.value);
          render(groupSelect.value);
        };
        setInterval(() => render(groupSelect.value), 5 * 60 * 1000);

      } catch (e) {
        output.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
      }
    }

    loadSchedule();

    // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
    const btn = document.getElementById('themeToggle');
    btn.onclick = () => {
      document.body.classList.toggle('light');
      btn.textContent = document.body.classList.contains('light') ? '‚òÄÔ∏è' : 'üåô';
    };
  </script>
</body>
</html>
```
